<!DOCTYPE html>
<head>
    <title>Pong</title>
    <script src="../pixi.js"></script>
    <!--<script src="js/index.js"></script>-->
</head>
<body style="margin: 0;">
    <script type="module">
        class Carta {
            constructor(numero, girato){
                this.numero = numero;
                this.girato = girato;
            }
            getNumero() {
                return this.numero;
            }
            getDir() { 
                return 'Assets/Cards/' + this.numero + '.png';
            }
            getGirato() {
                return this.girato;
            }
        }

        const nCard = 12;
        const width = window.innerWidth, height = window.innerHeight - 5;
        
        const app = new PIXI.Application();
        await app.init({ width: width, height: height });
        document.body.appendChild(app.canvas);

        await PIXI.Assets.load('Assets/Background/snowdin.png');
        let bg = PIXI.Sprite.from('Assets/Background/snowdin.png');
        bg.width = width;
        bg.height = height;
        app.stage.addChild(bg);
        for(let i=0; i < 24; i++){
            await PIXI.Assets.load('Assets/Cards/' + i + ".png");
        }
        await PIXI.Assets.load('Assets/covered.jpg');
        
        const cards = [];
        const coveredCards = [];
        for(let i=0; i < nCard; i++){
            cards.push(new Carta(i, false));
        }
        for(let i=0; i < nCard; i++){
            cards.push(new Carta(i, false));
        }

        let n = 0;
        for(let i = 0; i < cards.length; i++) {
            let temp = cards[i];
            let j = Math.floor(Math.random() * cards.length);
            cards[i] = cards[j];
            cards[j] = temp;
        }

        let cardW = (width - 20 - (6 * 20))/6;
        let cardH = (height - 20 - (4 * 20))/4;
        let cont = 0;
        for(let i = 0; i < 4; i++) { 
            let h = 20 + (i * (cardH + 20));
            for(let j = 0; j < 6; j++) {
                let card = PIXI.Sprite.from('Assets/covered.jpg');
                card.x = 20 + (j * (cardW + 20));
                card.y = h;
                card.width = cardW; 
                card.height = cardH;
                card.interactive = true;
                card.buttonMode = true;
                card.on('pointerdown', onCardClick);
                card.cardData = cards[cont];
                coveredCards.push(card);
                app.stage.addChild(card);
                cont++;
            }
        }

        let firstSelected = null;
        let secondSelected = null;

        function onCardClick() { 
            if(this === firstSelected) {
                this.texture = PIXI.Texture.from('Assets/covered.jpg');
                firstSelected = null;
                return;
            }
            if (!firstSelected) {
                firstSelected = this;
                this.texture = PIXI.Texture.from(this.cardData.getDir()); // Uncover the card
            } else if (!secondSelected) {
                secondSelected = this;
                this.texture = PIXI.Texture.from(this.cardData.getDir()); // Uncover the card
                if (firstSelected.cardData.getNumero() === secondSelected.cardData.getNumero()) {
                    // Cards match
                    setTimeout(() => {
                        app.stage.removeChild(firstSelected);
                        app.stage.removeChild(secondSelected);
                        firstSelected = null;
                        secondSelected = null;
                    }, 1000);
                } else {
                    // Cards do not match
                    setTimeout(() => {
                        firstSelected.texture = PIXI.Texture.from('Assets/covered.jpg');
                        secondSelected.texture = PIXI.Texture.from('Assets/covered.jpg');
                        firstSelected = null;
                        secondSelected = null;
                    }, 1000);
                }
            }
        }
    </script>
</body>
</html>
